# 模組化架構文檔

## 概述

本專案已從單一文件結構重構為完整的模組化架構，採用現代 JavaScript 開發最佳實踐。

## 🏗️ 架構概覽

### 目錄結構
```
js/
├── app.js                      # 主應用程式入口
├── config/
│   └── Config.js              # 環境配置管理
├── data/
│   └── MockData.js            # 模擬數據與配置
├── services/
│   ├── ApiService.js          # API 服務層
│   ├── StorageService.js      # 存儲服務
│   └── StateManager.js       # 狀態管理
├── components/
│   ├── MenuComponent.js       # 菜單組件
│   ├── CartComponent.js       # 購物車組件
│   └── CheckoutComponent.js   # 結帳組件
└── utils/
    └── UtilityFunctions.js    # 工具函數庫
```

## 📋 模組說明

### 1. 主應用程式 (`app.js`)
- **職責**: 應用程式初始化和協調各模組
- **功能**: 
  - 初始化所有服務和組件
  - 設置全域事件監聽
  - 管理應用程式生命週期
  - 處理錯誤和載入狀態

### 2. 配置管理 (`config/Config.js`)
- **職責**: 環境配置和功能標記管理
- **功能**:
  - 自動檢測運行環境
  - 提供環境特定配置
  - 功能標記控制
  - 遠端配置載入

### 3. 數據層 (`data/MockData.js`)
- **職責**: 提供模擬數據和應用配置
- **內容**:
  - 菜單項目數據
  - 分類資訊
  - 餐廳配置
  - API 端點定義

### 4. 服務層

#### API 服務 (`services/ApiService.js`)
- **職責**: 處理所有 API 通信
- **功能**:
  - HTTP 請求封裝
  - 錯誤處理
  - 重試機制
  - 模擬數據回退

#### 存儲服務 (`services/StorageService.js`)
- **職責**: 本地數據持久化
- **功能**:
  - localStorage/sessionStorage 封裝
  - 數據序列化/反序列化
  - 存儲配額管理
  - 清理和維護

#### 狀態管理 (`services/StateManager.js`)
- **職責**: 集中式狀態管理
- **功能**:
  - 發布/訂閱模式
  - 狀態變更追蹤
  - 中間件支援
  - 歷史記錄

### 5. 組件層

#### 菜單組件 (`components/MenuComponent.js`)
- **職責**: 菜單顯示和互動
- **功能**:
  - 菜單項目渲染
  - 分類篩選
  - 商品搜尋
  - 添加到購物車

#### 購物車組件 (`components/CartComponent.js`)
- **職責**: 購物車管理
- **功能**:
  - 購物車項目顯示
  - 數量調整
  - 項目移除
  - 總價計算

#### 結帳組件 (`components/CheckoutComponent.js`)
- **職責**: 訂單結帳流程
- **功能**:
  - 表單驗證
  - 訂單處理
  - 支付流程
  - 成功頁面

### 6. 工具函數 (`utils/UtilityFunctions.js`)
- **職責**: 提供通用工具函數
- **類別**:
  - ValidationUtils: 表單驗證
  - FormatUtils: 數據格式化
  - DomUtils: DOM 操作
  - Utils: 通用工具

## 🔄 數據流

```
[用戶操作] → [組件] → [狀態管理] → [服務層] → [API/存儲]
                ↓         ↓
           [UI更新] ← [事件通知] ← [狀態變更]
```

## 🎯 設計原則

### 1. 單一職責原則
每個模組只負責一個特定的功能領域。

### 2. 依賴注入
組件通過構造函數接收依賴，便於測試和替換。

### 3. 事件驅動
使用事件系統進行組件間通信，減少耦合。

### 4. 配置驅動
通過配置文件控制應用行為，支援多環境部署。

### 5. 錯誤隔離
每層都有適當的錯誤處理，防止錯誤向上傳播。

## 🔧 開發指南

### 添加新組件
1. 在 `js/components/` 創建新文件
2. 實作組件類別
3. 在 `app.js` 中註冊
4. 添加相應樣式

### 添加新服務
1. 在 `js/services/` 創建新文件
2. 實作服務接口
3. 在 `app.js` 中初始化
4. 通過依賴注入提供給組件

### 修改配置
1. 更新 `config/Config.js` 中的配置
2. 重新載入應用或調用 `config.reload()`

### 添加新的工具函數
1. 在相應的工具類中添加方法
2. 確保函數是純函數或靜態方法
3. 添加適當的錯誤處理

## 🧪 測試策略

### 單元測試
- 每個工具函數都應有對應測試
- 服務類的公共方法需要測試
- 組件的核心邏輯需要測試

### 整合測試
- 測試組件與服務的整合
- 測試狀態管理流程
- 測試 API 服務與後端的整合

### 端到端測試
- 測試完整的用戶流程
- 測試跨瀏覽器兼容性
- 測試響應式設計

## 🚀 部署考量

### 生產環境
- 設置 `api.mockMode: false`
- 配置正確的 API 端點
- 啟用壓縮和快取
- 設置錯誤監控

### 開發環境
- 保持調試模式開啟
- 使用模擬數據
- 啟用詳細日誌
- 支援熱重載

## 📈 性能優化

### 載入優化
- 模組按需載入
- 圖片懶載入
- 資源壓縮
- CDN 使用

### 運行優化
- 事件委派
- 防抖和節流
- 虛擬滾動
- 記憶化

## 🔮 未來擴展

### 後端整合
- 更新 API 服務配置
- 添加認證機制
- 實作實時通信
- 數據同步

### 功能擴展
- 用戶系統
- 訂單歷史
- 推送通知
- 多語言支援

---

這個模組化架構為未來的功能擴展和維護提供了堅實的基礎。